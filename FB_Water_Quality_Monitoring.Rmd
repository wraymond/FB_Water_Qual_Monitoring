---
title: "FB_Water_Qaulity_Monitoring"
author: "Wendel Raymond"
date: "August 19, 2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

## False Bay Watershed Water Quality Monitoring

```{r echo=FALSE}
library(tidyverse)
library(ggplot2)
library(rnoaa)
library(lubridate)
library(cowplot)
library(noaaoceans)

theme_set(theme_classic())
```

### Data
#### Monitoring data
Load raw water quality and nutrient data
```{r}
qual <- read.csv("../Data/FBWS_water_quality_monitoring.csv", header = TRUE, stringsAsFactors = FALSE)

nuts <- read.csv("../Data/FBWS_water_nutrients.csv", header = TRUE, stringsAsFactors = FALSE)
```

##### Data management

Define data data as POSIXct data
```{r echo=FALSE}
qual$sample_date <- as.POSIXct(qual$sample_date, format = "%m/%d/%Y")
nuts$sample_date <- as.POSIXct(nuts$sample_date, format = "%m/%d/%Y")
```

Combine nutrient with TN and TP data for a given date and station. Bring along/keep stations where only TNP are collected.
```{r}
nuts.nut <- nuts %>% 
  filter(PO4_umol > 0)

nuts.tnp <- nuts %>% 
  filter(TP_umol > 0)

nuts.comb <- merge(nuts.nut[, 1:11], nuts.tnp[, c(2, 3, 4, 12, 13)], by = c("sample_date", "station_name"), all.y = TRUE)
```

Compute mean TNP and nutrient values for a given date and station. This will produce a single nutrient and tnp values for each unique date and station combination.
```{r}
nuts.mean <- nuts.comb %>% 
  group_by(station_name, sample_date) %>% 
  summarise(PO4_umol = mean(PO4_umol),
            SiOH4_umol = mean(SiOH4_umol),
            NO3_umol = mean(NO3_umol),
            NO2_umol = mean(NO2_umol),
            NH4_umol = mean(NH4_umol),
            TP_umol = mean(TP_umol),
            TN_umol = mean(TN_umol))
```

Merge nutrients data with water quality data.
```{r}
dat <- merge(qual[, 1:11], nuts.mean, by = c("station_name", "sample_date"), all.x = TRUE)
```

###### Nutrient math!
```{r}
## N to P ratio ##
dat$N_P <- dat$TN_umol/dat$TP_umol

## Total dissolved N ##
dat$N_Total_umol <- (dat$NH4_umol + dat$NO2_umol + dat$NO3_umol)

## TN minus dissolved N ##
dat$TN_minus_umol <- (dat$TN_umol - dat$N_Total)

## TP minus phosphate ##
dat$TP_minus_umol <- (dat$TP_umol - dat$PO4_umol)
```

Add abbreviated names and force order
```{r}
dat <- dat %>% 
  mutate(station_abb = case_when(
    station_id == "FBWS_1" ~ "FB - Nearshore",
    station_id == "FBWS_2" ~ "FBC - Mouth",
    station_id == "FBWS_3" ~ "FBC - Bailer Hill",
    station_id == "FBWS_4" ~ "FBC - Lower",
    station_id == "FBWS_5" ~ "SJVC - Lower",
    station_id == "FBWS_6" ~ "Emm - Outlet",
    station_id == "FBWS_7" ~ "LZ - Lower Dam",
    station_id == "FBWS_8" ~ "UZ - Inlet",
    station_id == "FBWS_9" ~ "SJVC - Upper",
    station_id == "FBWS_10" ~ "Emm - Wetland",
    station_id == "FBWS_11" ~ "Emm - Culvert"
  ))

dat$station_abb <- factor(dat$station_abb, levels = c("UZ - Inlet", "SJVC - Upper", "Emm - Culvert", "Emm - Wetland", "Emm - Outlet", "LZ - Lower Dam", "FBC - Lower",  "SJVC - Lower", "FBC - Bailer Hill", "FBC - Mouth", "FB - Nearshore"))
```

#### Friday Harbor Airport data

Read data pulled from NOAA
```{r}
fh <- read.csv("../Data/FH_Airport_1.2000_1.2023.csv", header = TRUE, stringsAsFactors = FALSE)
```

##### Data management
Define date as POSIXct and spread to create day month year columns
```{r}
fh$DATE <- as.POSIXct(fh$DATE, format = "%Y-%m-%d")
fh <- fh %>% 
  mutate(month = format(DATE, "%m"), year = format(DATE, "%Y"), day = format(DATE, "%d"))
```

Compute monthly total precipitation and mean daily temperature
```{r}
fh.monthly <- fh %>% 
  group_by(year, month) %>% 
  summarise(total.precip = sum(PRCP, na.rm = TRUE),
            mean.tmax = mean(TMAX, na.rm = TRUE),
            mean.tmin = mean(TMIN, na.rm = TRUE)) %>%
  mutate(day = 2) %>% 
  mutate(date = make_date(year, month, day)) %>% 
  mutate(date = format(as.POSIXct(date, format = "%m/%d/%Y %H:%M:%S"), format = "%m/%d/%Y"))

fh.monthly$date <- as.POSIXct(fh.monthly$date, format = "%m/%d/%Y")
```

#### Upwelling
Taken from La Push Station

```{r}
upwell <- read.csv("../Data/upwelldaily_1675362669_674.csv", header = TRUE, stringsAsFactors = FALSE)
```

##### Data managemnet

Rename cols
```{r}
upwell <- upwell %>% 
  rename(OffTrans_m3s = Offshore.Transport..m.3.s.100m.,
         CummOffTrans_m3s = Cumulative.Offshore.Transport..m.3.s.100m.,
         AlongTrans_m3s = Along.shore.Transport..m.3.s.100m.,
         CummAlongTrans_m3s = Cumulative.Along.shore.Transport..m.3.s.100m.)
```

Define date as POSIXct
```{r}
upwell$Date <- as.POSIXct(upwell$Date, format = "%m/%d/%Y")
```

#### Buoy data

Pull data from different buoys

```{r}
test <- as.data.frame(buoy_stations())
buoy.dat <- buoy(dataset = "stdmet", buoyid = 46267, refresh = TRUE)

buoy.dat <- as.data.frame(buoy.dat$data)
```


#### False Bay Creek flow data
```{r}
flow <- read.csv("../Data/FBWS_FBC_Flow.csv", header = TRUE, stringsAsFactors = FALSE)
```

##### Data managemnt
Define date as POSIXct
```{r}
flow$date <- as.POSIXct(flow$date, format = "%m/%d/%Y")
```

Compute mean flow for a given date
```{r}
flow.sum <- flow %>% 
  group_by(station_name, date) %>% 
  summarise(flow_cfs = mean(flow_cfs, na.rm = TRUE))
```

dat.sum$NO3_umol <- (dat.sum$NO3_mgL * 1000) * 0.016128

#### Tidbit Loggers
Load tidbit logger data
```{r}
tid.Bailer <- read.csv("../Data/FBCreek_BailerHill_Apr2021_May2022_clean.csv", header = TRUE, stringsAsFactors = FALSE)
tid.UpZyls <- read.csv("../Data/ZylLake_Inlet_Apr2021_May2022_clean.csv", header = TRUE, stringsAsFactors = FALSE)
tid.LowFBC <- read.csv("../Data/FBCreek_Lower_Apr2021_May2022_clean.csv", header = TRUE, stringsAsFactors = FALSE)
tid.MouthFBC <- read.csv("../Data/FBCreek_Mouth_Apr2021_May2022_clean.csv", header = TRUE, stringsAsFactors = FALSE)
tid.UpSJVC <- read.csv("../Data/SJVCreek_Upper_Apr2021_May2022_clean.csv", header = TRUE, stringsAsFactors = FALSE)
tid.OutEmm <- read.csv("../Data/WoodDuckPond_Outlet_Apr2021_May2022_clean.csv", header = TRUE, stringsAsFactors = FALSE)
```

##### Data managment
Assign names

```{r}
tid.Bailer$station_id <- "FBWS_3"
tid.UpZyls$station_id <- "FBWS_8"
tid.LowFBC$station_id <- "FBWS_4"
tid.MouthFBC$station_id <- "FBWS_2"
tid.UpSJVC$station_id <- "FBWS_9"
tid.OutEmm$station_id <- "FBWS_6"
```

Combine files
```{r}
tid.dat <- bind_rows(tid.Bailer, tid.UpZyls, tid.LowFBC, tid.MouthFBC, tid.UpSJVC, tid.OutEmm)
```

Manage date
```{r}
tid.dat$date <- as.POSIXct(tid.dat$date, format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")
```

Limit date range to April 22 2021 to May 23 2022
```{r}
tid.dat <- tid.dat %>% 
  filter(between(date, as.POSIXct('2021-04-22 00:00:00'), as.POSIXct('2022-05-23 00:00:00')))
```

Compute daily mean

```{r}
tid.dat <- tid.dat %>% 
  mutate(month = format(date, "%m"), year = format(date, "%Y"), day = format(date, "%d"),
         date_short = format(as.POSIXct(date, format = "%m/%d/%Y %H:%M:%S"), format = "%m/%d/%Y"))

tid.daily <- tid.dat %>% 
  group_by(station_id, date_short) %>% 
  summarise(mean_temp = mean(temp_c),
            sd_temp = sd(temp_c))

tid.daily$date_short <- as.POSIXct(tid.daily$date_short, format = "%m/%d/%Y")

tid.daily <- left_join(tid.daily, dat[, c(3, 20)])
```

#### Ulva

```{r}
## On the ground collection ##
ul <- read.csv("../Data/FBWS_ulva_cover.csv", header = TRUE, stringsAsFactors = FALSE)

## Done captured ##
ul.drone <- read.csv("../Data/FBWS_drone_ulva_cover.csv", header = TRUE, stringsAsFactors = FALSE)
```

##### Data managment

On the ground Ulva data
```{r}
## Calculations ##
ul$dry_mass_g <- ul$dry_tray_ulva_mass_g - ul$tray_mass_g
ul$dry_mass_gmsq <- ul$dry_mass_g / ul$ulva_collection_corr

## Date ##
ul$date <- as.POSIXct(ul$date, format = "%m/%d/%Y")
```

Compute summary
```{r}
ul.sum <- ul %>% 
  group_by(date) %>% 
  summarise(mean_prim_sed = mean(prim_substrate_no, na.rm = TRUE),
            sd_prim_sed = sd(prim_substrate_no, na.rm = TRUE),
            mean_secd_sed = mean(secd_substrate_no, na.rm = TRUE),
            sd_secd_sed = sd(secd_substrate_no, na.rm = TRUE),
            mean_ul_mass_gmsq = mean(dry_mass_gmsq, na.rm = TRUE),
            sd_ul_mass_gmsq = sd(dry_mass_gmsq, na.rm = TRUE))
```

Drone data
```{r}
ul.drone$sample_date <- as.POSIXct(ul.drone$sample_date, format = "%m/%d/%Y")

ul.drone <- ul.drone %>% 
  mutate(ulva_area_msq = ulva_pix * pixel_area_mxm,
         other_area_msq = other_pix * pixel_area_mxm,
         ul_percent_cover = ulva_area_msq / (ulva_area_msq + other_area_msq))
```

### Trends

#### Temperature

##### Point

Nearshore
```{r echo=FALSE}
## Point ##
png(filename = "../Figures/Temp_Water_Point.png", width = 6.5, height = 8, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id != "FBWS_11")) +
  geom_point(aes(x = sample_date, y = temp_c), size = 2) +
  scale_y_continuous(limits = c(-2, 30), breaks = seq(-0, 30, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y") +
  ylab("Temperature (°C)") + 
  xlab("Date") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~ station_abb, nrow = 5, ncol = 2)
dev.off()
```

##### Tidbits
```{r}
## Tidbit ##
png(filename = "../Figures/Temp_Water_Tidbit.png", width = 6.5, height = 4.8, res = 400, units = "in")
ggplot(tid.daily) +
  geom_line(aes(x = date_short, y = mean_temp), size = 1) +
  geom_ribbon(aes(x = date_short, ymin = mean_temp - sd_temp, ymax = mean_temp + sd_temp), alpha = 0.4) +
  scale_y_continuous(limits = c(-5, 30), breaks = seq(-5, 30, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y") +
  ylab("Temperature (°C)") +
  xlab("Date") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 14)) +
  facet_wrap(~ station_abb, nrow = 3, ncol = 2)
dev.off()
```

#### Dissolved oxygen
```{r echo=FALSE}
png(filename = "../Figures/DO_Point.png", width = 6.5, height = 8, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id != "FBWS_11")) +
  geom_point(aes(x = sample_date, y = DO_mgL), size = 2) +
  scale_y_continuous(limits = c(0, 18), breaks = seq(0, 18, by = 4))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y") +
  ylab("DO (mg/l)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1 , size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, nrow = 5, ncol = 2)
dev.off()
```

#### Salinity
```{r}
png(filename = "../Figures/Sal_Point.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = sal_ppt), size = 1.75) +
  scale_y_continuous(limits = c(0, 34), breaks = seq(0, 34, by = 4))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y") +
  ylab("Salinity (ppt)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()
```

#### Total Phosphorus
```{r}
## TP ##
png(filename = "../Figures/TP_Point.png", width = 6.5, height = 8, res = 400, units = "in")
ggplot(dat %>%
         filter(!station_id %in% c("FBWS_11"))) +
  geom_point(aes(x = sample_date, y = TP_umol), size = 1.75) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Total P (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 5, ncol = 2)
dev.off()

## TP Station 1 and 2 only ##
png(filename = "../Figures/TP_Point_1_2.png", width = 5, height = 4, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = TP_umol), size = 1.75) +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Total P (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()

## TP minus ##
png(filename = "../Figures/TP_minus_P_Point.png", width = 5, height = 6, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = TP_minus_umol), size = 1.75) +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Total P (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()

## TP / Phosphate ##
png(filename = "../Figures/TP_P_Point.png", width = 5, height = 6, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = (TP_umol / PO4_umol)), size = 1.75) +
  scale_y_continuous(limits = c(0, 8), breaks = seq(0, 8, by = 2)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Total P (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()
```

#### Total Nitrogen
```{r}
## TN ##
png(filename = "../Figures/TN_Point.png", width = 6.5, height = 8, res = 400, units = "in")
ggplot(dat %>%
        filter(!station_id %in% c("FBWS_11"))) +
  geom_point(aes(x = sample_date, y = TN_umol), size = 1.75) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Total N (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 5, ncol = 2)
dev.off()

## TN  Station 1 and 2 ##
png(filename = "../Figures/TN_Point_1_2.png", width = 5, height = 6, res = 400, units = "in")
ggplot(dat %>%
        filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = TN_umol), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Total N (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()

## N members ##
png(filename = "../Figures/N_Point.png", width = 5, height = 6, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = N_Total_umol), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("N members (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()

## TN minus ##
png(filename = "../Figures/TN_minus_N_Point.png", width = 5, height = 6, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = TN_minus_umol), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("TN - N members (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()

## TN / N members ##
png(filename = "../Figures/TN_N_Point.png", width = 5, height = 6, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = (TN_umol / N_Total_umol)), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("TN / N members") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()
```

#### N:P
```{r}
png(filename = "../Figures/NtoP_Point.png", width = 6.5, height = 8, res = 400, units = "in")
ggplot(dat %>%
        filter(!station_id %in% c("FBWS_11"))) +
  geom_point(aes(x = sample_date, y = N_P), size = 1.75) +
  geom_hline(aes(yintercept = 16), color = "red") +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Total N (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 5, ncol = 2)
dev.off()
```

#### Phosphate
```{r}
png(filename = "../Figures/Phos_Point.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = PO4_umol), size = 2) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Phosphate (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()

png(filename = "../Figures/Phos_FBWS_1.png", width = 5, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1"))) +
  geom_point(aes(x = sample_date, y = PO4_umol), size = 2) +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Phosphate (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12))
dev.off()

png(filename = "../Figures/TP_Phos_FBWS_1.png", width = 5, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1"))) +
  geom_point(aes(x = sample_date, y = (TP_umol - PO4_umol)), size = 2) +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("TP - Phosphate (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12))
dev.off()
```

#### Nitrate
```{r}
png(filename = "../Figures/Nitrate_Point.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = NO3_umol), size = 2) +
  scale_y_continuous(limits = c(0, 25), breaks = seq(0, 25, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Nitrate (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, nrow = 2, ncol = 1)
dev.off()

png(filename = "../Figures/Nitrate_FBWS_1.png", width = 5, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% "FBWS_1")) +
  geom_point(aes(x = sample_date, y = NO3_umol), size = 2) +
  scale_y_continuous(limits = c(0, 25), breaks = seq(0, 25, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Nitrate (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12))
dev.off()
```

#### Nitrite
```{r}
png(filename = "../Figures/Nitrite_Point.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = NO2_umol), size = 2) +
  scale_y_continuous(limits = c(0, 1.2), breaks = seq(0, 1.2, by = 0.2)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Nitrite (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, nrow = 2, ncol = 1)
dev.off()
```

#### Silicate
```{r}
png(filename = "../Figures/Silic_Point.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = SiOH4_umol), size = 2) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Silicate (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()
```

#### Ammonium
```{r}
png(filename = "../Figures/Ammon_Point.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = NH4_umol), size = 2) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 25)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-08-01 00:00:00"))) +
  ylab("Ammonium (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()
```

#### Precipitation
```{r}
## Sampling window ##
png(filename = "../Figures/Precip_Airport_Samp.png", width = 5, height = 4, res = 400, units = "in")
ggplot(fh.monthly) +
  geom_col(aes(x = date, y = total.precip)) +
  scale_y_continuous(limits = c(0, 250), breaks = seq(0, 250, by = 50), sec.axis = sec_axis(trans = ~./24.5, name = "Total precipitation (in)")) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01"), as.POSIXct("2023-01-01"))) +
  ylab("Total precipitation (mm)") +
  xlab("Month") +
  theme(text = element_text(size = 12), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()

## All time ##
png(filename = "../Figures/Precip_Airport.png", width = 6.5, height = 4, res = 400, units = "in")
ggplot(fh.monthly) +
  geom_col(aes(x = date, y = total.precip)) +
  geom_smooth(aes(x = date, y = total.precip), method = "loess") +
  scale_y_continuous(limits = c(0, 250), breaks = seq(0, 250, by = 50), sec.axis = sec_axis(trans = ~./24.5, name = "Total precipitation (in)")) +
  scale_x_datetime(date_breaks = "year", date_labels = "%Y") +
  ylab("Total precipitation (mm)") +
  xlab("") +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()
```

#### Upwelling
```{r}
png(filename = "../Figures/LaPush_Upwelling.png", width = 6, height = 4, res = 400, units = "in")
ggplot(upwell) +
  geom_point(aes(x = Date, y = OffTrans_m3s), size = 0.75) +
  geom_hline(aes(yintercept = 0), color = "#8F8F8F") +
  scale_y_continuous(limits = c(-1000, 250), breaks = seq(-1000, 250, by = 100)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y") +
  ylab("Offshore Transport Index") +
  xlab("Date") +
  theme(text = element_text(size = 12), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()
```


#### Combo plots
```{r}
## Nitrate and ulva mass ##
p.no3 <- ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = NO3_umol, color = station_abb), size = 2) +
  geom_line(aes(x = sample_date, y = NO3_umol, color = station_abb), size = 1) +
  scale_color_manual("Station", values = c("#B0891C", "#3C4BBA")) +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01"), as.POSIXct("2022-09-01"))) +
  ylab("NItrate (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  theme(legend.position = c(0.2, 0.9), legend.text = element_text(size = 6), legend.title = element_text(size = 10))

p.ulmass <- ggplot(ul) +
  geom_boxplot(aes(date, y = dry_mass_gmsq, group = date)) +
  scale_y_continuous(limits = c(0, 300), breaks = seq(0, 300, by = 50))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01"), as.POSIXct("2022-09-01"))) +
  ylab("Ulva mass (g/m sq)") +
  xlab("Month") +
  theme(text = element_text(size = 12), axis.text.x = element_text(angle = 45, hjust = 1 , size = 8))

png(filename = "../Figures/NO3_UlvaMass.png", width = 4, height = 6.5, res = 400, units = "in")
plot_grid(p.no3, p.ulmass, nrow = 2, ncol = 1, align = "v")
dev.off()
```


#### Air Temp
```{r}
png(filename = "../Figures/AirTemp_Airport_Samp.png", width = 5, height = 4, res = 400, units = "in")
ggplot(fh.monthly) +
  geom_point(aes(x = date, y = mean.tmax), size = 2, color = "red") +
  geom_point(aes(x = date, y = mean.tmin), size = 2, color = "blue") +
  scale_y_continuous(limits = c(-5, 30), breaks = seq(-5, 30, by = 5))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01"), as.POSIXct("2023-01-01"))) +
  ylab("Temperature (°C)") +
  xlab("Month") +
  theme(text = element_text(size = 12), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()
```

#### Ulva

On the ground
```{r}
## Plots of Means ##
png(filename = "../Figures/Ulva_mass.png", width = 5, height = 4, res = 400, units = "in")
ggplot(ul.sum) +
  geom_point(aes(x = date, y = mean_ul_mass_gmsq), size = 2) +
  geom_errorbar(aes(x = date, ymin = mean_ul_mass_gmsq - sd_ul_mass_gmsq, ymax = mean_ul_mass_gmsq + sd_ul_mass_gmsq), width = 0) +
  scale_y_continuous(limits = c(-30, 180), breaks = seq(-30, 180, by = 30))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01"), as.POSIXct("2023-01-01"))) +
  ylab("Ulva mass (g/m sq)") +
  xlab("Month") +
  theme(text = element_text(size = 12), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()

## Box plot ##
png(filename = "../Figures/Ulva_mass_box.png", width = 5, height = 4, res = 400, units = "in")
ggplot(ul) +
  geom_boxplot(aes(date, y = dry_mass_gmsq, group = date)) +
  scale_y_continuous(limits = c(0, 300), breaks = seq(0, 300, by = 50))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01"), as.POSIXct("2022-09-01"))) +
  ylab("Ulva mass (g/m sq)") +
  xlab("Month") +
  theme(text = element_text(size = 12), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()
```

Drone
```{r}
mean(ul.drone$ul_percent_cover)
png(filename = "../Figures/Ulva_prop_drone.png", width = 5, height = 4, res = 400, units = "in")
ggplot(ul.drone) +
  geom_point(aes(x = sample_date, y = ul_percent_cover), size = 2) +
  scale_y_continuous(limits = c(0, 0.8), breaks = seq(0, 0.8, by = 0.2))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01"), as.POSIXct("2023-01-01"))) +
  ylab("Proportion Ulva") +
  xlab("Month") +
  theme(text = element_text(size = 12), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()
```

Flow
```{r}
ggplot(flow.sum) +
  geom_point(aes(x = date, y = flow_cfs, color = station_name), size = 2) +
  scale_color_manual("Station", labels = c("AUG-2", "FCB - Bailer Hill"), values = c("#AD640C", "#42AC0D")) +
  scale_y_continuous(limits = c(-2, 30), breaks = seq(0, 30, by = 5))  +
  #scale_x_datetime(breaks = seq(as.POSIXct("2021-10-15"), as.POSIXct("2021-12-1"), "day"), date_labels = "%b-%m", limits = c(as.POSIXct("2021-10-15"), as.POSIXct("2021-12-1"))) +
  ylab("Flow (CFS)") +
  xlab("Date")  +
  theme(text = element_text(size=20), axis.text.x = element_text(angle = 45, hjust = 1))
```
