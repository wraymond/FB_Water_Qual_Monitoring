---
title: "FB_Water_Qaulity_Monitoring"
author: "Wendel Raymond"
date: "August 19, 2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

## False Bay Watershed Water Quality Monitoring

```{r echo=FALSE}
library(tidyverse)
library(ggplot2)
library(lubridate)
library(cowplot)

theme_set(theme_classic())
options(noaakey = "tDzKKwcWqlZFAcwgjTanQIpnFLZvAAET")
```

### Data
#### Monitoring data
Load raw water quality and nutrient data
```{r}
qual <- read.csv("../Data/FBWS_water_quality_monitoring.csv", header = TRUE, stringsAsFactors = FALSE)

nuts <- read.csv("../Data/FBWS_water_nutrients.csv", header = TRUE, stringsAsFactors = FALSE)
```

##### Data management

Define data data as POSIXct data
```{r echo=FALSE}
qual$sample_date <- as.POSIXct(qual$sample_date, format = "%m/%d/%Y")
nuts$sample_date <- as.POSIXct(nuts$sample_date, format = "%m/%d/%Y")
```

Combine nutrient with TN and TP data for a given date and station. Bring along/keep stations where only TNP are collected.
```{r}
nuts.nut <- nuts %>% 
  filter(PO4_umol > 0)

nuts.tnp <- nuts %>% 
  filter(TP_umol > 0)

nuts.comb <- merge(nuts.nut[, 1:11], nuts.tnp[, c(2, 3, 4, 12, 13)], by = c("sample_date", "station_name"), all.y = TRUE)
```

Compute mean TNP and nutrient values for a given date and station. This will produce a single nutrient and tnp values for each unique date and station combination.
```{r}
nuts.mean <- nuts.comb %>% 
  group_by(station_name, sample_date) %>% 
  summarise(PO4_umol = mean(PO4_umol),
            SiOH4_umol = mean(SiOH4_umol),
            NO3_umol = mean(NO3_umol),
            NO2_umol = mean(NO2_umol),
            NH4_umol = mean(NH4_umol),
            TP_umol = mean(TP_umol),
            TN_umol = mean(TN_umol))
```

Merge nutrients data with water quality data.
```{r}
dat <- merge(qual[, 1:11], nuts.mean, by = c("station_name", "sample_date"), all.x = TRUE)
```

###### Nutrient math!
```{r}
## N to P ratio ##
dat$N_P <- dat$TN_umol/dat$TP_umol

## Total dissolved N ##
dat$N_Total_umol <- (dat$NH4_umol + dat$NO2_umol + dat$NO3_umol)

## TN minus dissolved N ##
dat$TN_minus_umol <- (dat$TN_umol - dat$N_Total)

## TP minus phosphate ##
dat$TP_minus_umol <- (dat$TP_umol - dat$PO4_umol)

## N:P of TN minus:TP minus ##
dat$Nminus_Pminus <- (dat$TN_minus_umol / dat$TP_minus_umol)
```

Add abbreviated names and force order
```{r}
dat <- dat %>% 
  mutate(station_abb = case_when(
    station_id == "FBWS_1" ~ "1:FB - Nearshore",
    station_id == "FBWS_2" ~ "2:FBC - Mouth",
    station_id == "FBWS_3" ~ "3:FBC - Bailer Hill",
    station_id == "FBWS_4" ~ "4:FBC - Lower",
    station_id == "FBWS_5" ~ "5:SJVC - Lower",
    station_id == "FBWS_6" ~ "6:Emm - Outlet",
    station_id == "FBWS_7" ~ "7:LZ - Lower Dam",
    station_id == "FBWS_8" ~ "8:UZ - Inlet",
    station_id == "FBWS_9" ~ "9:SJVC - Upper",
    station_id == "FBWS_10" ~ "10:Emm - Wetland",
    station_id == "FBWS_11" ~ "11:Emm - Culvert"
  ))

dat$station_abb <- factor(dat$station_abb, levels = c("8:UZ - Inlet", "9:SJVC - Upper", "11:Emm - Culvert", "10:Emm - Wetland", "6:Emm - Outlet", "7:LZ - Lower Dam", "4:FBC - Lower",  "5:SJVC - Lower", "3:FBC - Bailer Hill", "2:FBC - Mouth", "1:FB - Nearshore"))


```

#### Friday Harbor Airport data

Read data pulled from NOAA
```{r}
fh <- read.csv("../Data/FH_Airport_1.2000_1.2023.csv", header = TRUE, stringsAsFactors = FALSE)
```

##### Data management
Define date as POSIXct and spread to create day month year columns
```{r}
fh$DATE <- as.POSIXct(fh$DATE, format = "%Y-%m-%d")
fh <- fh %>% 
  mutate(month = format(DATE, "%m"), year = format(DATE, "%Y"), day = format(DATE, "%d"))
```

Compute monthly total precipitation and mean daily temperature
```{r}
fh.monthly <- fh %>% 
  group_by(year, month) %>% 
  summarise(total.precip = sum(PRCP, na.rm = TRUE),
            mean.tmax = mean(TMAX, na.rm = TRUE),
            mean.tmin = mean(TMIN, na.rm = TRUE)) %>%
  mutate(day = 2) %>% 
  mutate(date = make_date(year, month, day)) %>% 
  mutate(date = format(as.POSIXct(date, format = "%m/%d/%Y %H:%M:%S"), format = "%m/%d/%Y"))

fh.monthly$date <- as.POSIXct(fh.monthly$date, format = "%m/%d/%Y")

fh.monthly.sum <- fh.monthly %>% 
  group_by(month) %>% 
  summarise(mean_tot_precip = mean(total.precip),
            sd_tot_precip  = sd(total.precip)) %>% 
  mutate(month = as.numeric(month))

fh.monthly.sum <- bind_rows(fh.monthly.sum, fh.monthly.sum)
fh.monthly.sum$year <- c(rep(2021, 12), rep(2022, 12))
fh.monthly.sum$day <- rep(1, 24)
fh.monthly.sum$date <- make_date(fh.monthly.sum$year, fh.monthly.sum$month, fh.monthly.sum$day)
fh.monthly.sum$date <- as.POSIXct(fh.monthly.sum$date, format = "%Y-%m-%d")

fh.monthly.sum$sd_max_monthly <- fh.monthly.sum$mean_tot_precip + fh.monthly.sum$sd_tot_precip
fh.monthly.sum$sd_min_monthly <- fh.monthly.sum$mean_tot_precip - fh.monthly.sum$sd_tot_precip
fh.monthly.sum$sd_min_monthly <- ifelse(fh.monthly.sum$sd_min_monthly < 0, 0, fh.monthly.sum$sd_min_monthly)
```

#### Upwelling
Taken from La Push Station

```{r}
upwell1 <- read.csv("../Data/upwelldaily_1675362669_674.csv", header = TRUE, stringsAsFactors = FALSE)
upwell2 <- read.csv("../Data/upwelldaily_1675984913_724.csv", header = TRUE, stringsAsFactors = FALSE)
upwell3 <- read.csv("../Data/upwelldaily_1675998516_201.csv", header = TRUE, stringsAsFactors = FALSE)
upwell4 <- read.csv("../Data/upwelldaily_1676052104_490.csv", header = TRUE, stringsAsFactors = FALSE)
upwell5 <- read.csv("../Data/upwelldaily_1676052115_208.csv", header = TRUE, stringsAsFactors = FALSE)
upwell6 <- read.csv("../Data/upwelldaily_1676052198_278.csv", header = TRUE, stringsAsFactors = FALSE)
upwell7 <- read.csv("../Data/upwelldaily_1676053516_536.csv", header = TRUE, stringsAsFactors = FALSE)
```

##### Data managemnet

Rename cols
```{r}
upwell <- bind_rows(upwell1, upwell2, upwell3, upwell4, upwell5, upwell6, upwell7)

upwell <- upwell %>% 
  rename(OffTrans_m3s = Offshore.Transport..m.3.s.100m.,
         CummOffTrans_m3s = Cumulative.Offshore.Transport..m.3.s.100m.,
         AlongTrans_m3s = Along.shore.Transport..m.3.s.100m.,
         CummAlongTrans_m3s = Cumulative.Along.shore.Transport..m.3.s.100m.)

upwell$Date <- as.POSIXct(upwell$Date, format = "%m/%d/%Y")

upwell.month <- upwell %>% 
  mutate(month = format(Date, "%m"), year = format(Date, "%Y"), day = format(Date, "%d")) %>% 
  group_by(month, year) %>% 
  summarise(mean_OffTrans_m3s = mean(OffTrans_m3s),
            sd_OffTrans_m3s = sd(OffTrans_m3s)) %>% 
  mutate(day = 1) %>% 
  mutate(date = make_date(year, month, day)) %>% 
  mutate(date = format(as.POSIXct(date, format = "%m/%d/%Y %H:%M:%S"), format = "%m/%d/%Y"))
  
```

Define date as POSIXct
```{r}
upwell$Date <- as.POSIXct(upwell$Date, format = "%m/%d/%Y")
upwell.month$date <- as.POSIXct(upwell.month$date, format = "%m/%d/%Y")
```

#### False Bay Creek flow data
```{r}
flow <- read.csv("../Data/FBWS_FBC_Flow.csv", header = TRUE, stringsAsFactors = FALSE)
```

##### Data managemnt
Define date as POSIXct
```{r}
flow$date <- as.POSIXct(flow$date, format = "%m/%d/%Y")
```

Compute mean flow for a given date
```{r}
flow.sum <- flow %>% 
  group_by(station_name, date) %>% 
  summarise(flow_cfs = mean(flow_cfs, na.rm = TRUE))
```

dat.sum$NO3_umol <- (dat.sum$NO3_mgL * 1000) * 0.016128

#### Tidbit Loggers
Load tidbit logger data
```{r}
tid.Bailer <- read.csv("../Data/FBCreek_BailerHill_Apr2021_May2022_clean.csv", header = TRUE, stringsAsFactors = FALSE)
tid.UpZyls <- read.csv("../Data/ZylLake_Inlet_Apr2021_May2022_clean.csv", header = TRUE, stringsAsFactors = FALSE)
tid.LowFBC <- read.csv("../Data/FBCreek_Lower_Apr2021_May2022_clean.csv", header = TRUE, stringsAsFactors = FALSE)
tid.MouthFBC <- read.csv("../Data/FBCreek_Mouth_Apr2021_May2022_clean.csv", header = TRUE, stringsAsFactors = FALSE)
tid.UpSJVC <- read.csv("../Data/SJVCreek_Upper_Apr2021_May2022_clean.csv", header = TRUE, stringsAsFactors = FALSE)
tid.OutEmm <- read.csv("../Data/WoodDuckPond_Outlet_Apr2021_May2022_clean.csv", header = TRUE, stringsAsFactors = FALSE)
```

##### Data managment
Assign names

```{r}
tid.Bailer$station_id <- "FBWS_3"
tid.UpZyls$station_id <- "FBWS_8"
tid.LowFBC$station_id <- "FBWS_4"
tid.MouthFBC$station_id <- "FBWS_2"
tid.UpSJVC$station_id <- "FBWS_9"
tid.OutEmm$station_id <- "FBWS_6"
```

Combine files
```{r}
tid.dat <- bind_rows(tid.Bailer, tid.UpZyls, tid.LowFBC, tid.MouthFBC, tid.UpSJVC, tid.OutEmm)
```

Manage date
```{r}
tid.dat$date <- as.POSIXct(tid.dat$date, format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")
```

Limit date range to April 22 2021 to May 23 2022
```{r}
tid.dat <- tid.dat %>% 
  filter(between(date, as.POSIXct('2021-04-22 00:00:00'), as.POSIXct('2022-05-23 00:00:00')))
```

Compute daily mean

```{r}
tid.dat <- tid.dat %>% 
  mutate(month = format(date, "%m"), year = format(date, "%Y"), day = format(date, "%d"),
         date_short = format(as.POSIXct(date, format = "%m/%d/%Y %H:%M:%S"), format = "%m/%d/%Y"))

tid.daily <- tid.dat %>% 
  group_by(station_id, date_short) %>% 
  summarise(mean_temp = mean(temp_c),
            sd_temp = sd(temp_c))

tid.daily$date_short <- as.POSIXct(tid.daily$date_short, format = "%m/%d/%Y")

tid.daily <- left_join(tid.daily, dat[, c(3, 20)])
```

Station abbreviations
```{r}
tid.daily <- tid.daily %>% 
  mutate(station_abb = case_when(
    station_id == "FBWS_1" ~ "1:FB - Nearshore",
    station_id == "FBWS_2" ~ "2:FBC - Mouth",
    station_id == "FBWS_3" ~ "3:FBC - Bailer Hill",
    station_id == "FBWS_4" ~ "4:FBC - Lower",
    station_id == "FBWS_5" ~ "5:SJVC - Lower",
    station_id == "FBWS_6" ~ "6:Emm - Outlet",
    station_id == "FBWS_7" ~ "7:LZ - Lower Dam",
    station_id == "FBWS_8" ~ "8:UZ - Inlet",
    station_id == "FBWS_9" ~ "9:SJVC - Upper",
    station_id == "FBWS_10" ~ "10:Emm - Wetland",
    station_id == "FBWS_11" ~ "11:Emm - Culvert"
  ))

tid.daily$station_abb <- factor(tid.daily$station_abb, levels = c("8:UZ - Inlet", "9:SJVC - Upper", "11:Emm - Culvert", "10:Emm - Wetland", "6:Emm - Outlet", "7:LZ - Lower Dam", "4:FBC - Lower",  "5:SJVC - Lower", "3:FBC - Bailer Hill", "2:FBC - Mouth", "1:FB - Nearshore"))
```


#### Ulva

```{r}
## On the ground collection ##
ul <- read.csv("../Data/FBWS_ulva_cover.csv", header = TRUE, stringsAsFactors = FALSE)

## Done captured ##
ul.drone <- read.csv("../Data/FBWS_drone_ulva_cover.csv", header = TRUE, stringsAsFactors = FALSE)
```

##### Data managment

On the ground Ulva data
```{r}
## Calculations ##
ul$dry_mass_g <- ul$dry_tray_ulva_mass_g - ul$tray_mass_g
ul$dry_mass_gmsq <- ul$dry_mass_g / ul$ulva_collection_corr

## Date ##
ul$date <- as.POSIXct(ul$date, format = "%m/%d/%Y")
```

Compute summary
```{r}
ul.sum <- ul %>% 
  group_by(date) %>% 
  summarise(mean_prim_sed = mean(prim_substrate_no, na.rm = TRUE),
            sd_prim_sed = sd(prim_substrate_no, na.rm = TRUE),
            mean_secd_sed = mean(secd_substrate_no, na.rm = TRUE),
            sd_secd_sed = sd(secd_substrate_no, na.rm = TRUE),
            mean_ul_mass_gmsq = mean(dry_mass_gmsq, na.rm = TRUE),
            sd_ul_mass_gmsq = sd(dry_mass_gmsq, na.rm = TRUE))
```

Drone data
```{r}
ul.drone$sample_date <- as.POSIXct(ul.drone$sample_date, format = "%m/%d/%Y")

ul.drone <- ul.drone %>% 
  mutate(ulva_area_msq = ulva_pix * pixel_area_mxm,
         other_area_msq = other_pix * pixel_area_mxm,
         ul_percent_cover = ulva_area_msq / (ulva_area_msq + other_area_msq))
```

### Trends

#### Temperature

```{r}
p.temp <- ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2", "FBWS_3"))) +
  geom_point(aes(x = sample_date, y = temp_c, shape = station_abb, color = station_abb), size = 1.6) +
  scale_shape_manual(values = c(15, 17, 16), labels = c("Bailer", "Mouth", "Nearshore")) +
  scale_color_manual(values = c("#E6003D", "#678F22", "#002575")) +
  labs(color = "Station") +
  theme(legend.position = "none") +
  scale_y_continuous(limits = c(0, 24), breaks = seq(0, 24, by = 4))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-03-30"), as.POSIXct("2022-09-01"))) +
  ylab("Temperature (°C)") +
  xlab("Month - Year") +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(plot.margin = unit(c(0, 0, 0 , 0.55), "cm"))
```


#### Mouth - Nearshore correlations
Calculate pearson correlation between nutrient values between mouth and nearshore stations

```{r}
dat.cor <- data.frame(sample_date = unique(dat$sample_date),
                      PO4 = sapply(cor(dat$PO4_umol[dat$station_id == "FBWS_1"], dat$PO4_umol[dat$station_id == "FBWS_2"], method = "pearson")))

dat.redu <- dat %>% 
  filter(station_id %in% c("FBWS_1", "FBWS_2"))


cor(dat.redu[1:20, 12], dat.redu[21:40, 12], method = "pearson")

dar.cor <- dat %>% 
  filter(station_id %in% c("FBWS_1", "FBWS_2")) %>% 
  summarise(po4 = cor(PO4_umol, PO4_umol, method = "pearson"),
            no3 = cor(NO3_umol, NO3_umol, method = "pearson"),
            no2 = cor(NO2_umol, NO2_umol, method = "pearson"),
            nh4 = cor(NH4_umol, NH4_umol, method = "pearson"))

cor(dat.redu$PO4_umol[dat.redu$station_id == "FBWS_1"], dat.redu$PO4_umol[dat.redu$station_id == "FBWS_2"])
cor(dat.redu$NO3_umol[dat.redu$station_id == "FBWS_1"], dat.redu$NO3_umol[dat.redu$station_id == "FBWS_2"])
cor(dat.redu$NO2_umol[dat.redu$station_id == "FBWS_1"], dat.redu$NO2_umol[dat.redu$station_id == "FBWS_2"])
cor(dat.redu$NH4_umol[dat.redu$station_id == "FBWS_1"], dat.redu$NH4_umol[dat.redu$station_id == "FBWS_2"])

dat.cor <- data.frame(sample_date = unique(dat$sample_date),
                      PO4_1 = dat.redu$PO4_umol[dat.redu$station_id == "FBWS_1"],
                      PO4_2 = dat.redu$PO4_umol[dat.redu$station_id == "FBWS_2"],
                      NO3_1 = dat.redu$NO3_umol[dat.redu$station_id == "FBWS_1"],
                      NO3_2 = dat.redu$NO3_umol[dat.redu$station_id == "FBWS_2"],
                      NO2_1 = dat.redu$NO2_umol[dat.redu$station_id == "FBWS_1"],
                      NO2_2 = dat.redu$NO2_umol[dat.redu$station_id == "FBWS_2"],
                      NH4_1 = dat.redu$NH4_umol[dat.redu$station_id == "FBWS_1"],
                      NH4_2 = dat.redu$NH4_umol[dat.redu$station_id == "FBWS_2"]
                      )

dat.cor <- data.frame(expand.grid(unique(dat$sample_date), c("Phosphate", "Nitrate", "Nitrite", "Ammonium")))
dat.cor$conc_1 <- c(dat.redu[21:40, 12], dat.redu[21:40, 14], dat.redu[21:40, 15], dat.redu[21:40, 16])
dat.cor$conc_2 <- c(dat.redu[1:20, 12], dat.redu[1:20, 14], dat.redu[1:20, 15], dat.redu[1:20, 16])

png(filename = "../Figures/Nuts_cor.png", width = 5, height = 5, res = 400, units = "in")
ggplot(dat.cor) +
  geom_point(aes(x = conc_1, y = conc_2)) +
  xlab("Nearshore (\u00b5mol)") +
  ylab("Mouth (\u00b5mol)") +
  facet_wrap(~Var2, nrow = 2, ncol = 2, scales = "free")
dev.off()
```



#### Point
Nearshore
```{r echo=FALSE}
## Point ##
png(filename = "../Figures/Temp_Water_Point.png", width = 6.5, height = 8, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id != "FBWS_11")) +
  geom_point(aes(x = sample_date, y = temp_c), size = 2) +
  scale_y_continuous(limits = c(-2, 25), breaks = seq(-0, 25, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y") +
  ylab("Temperature (°C)") + 
  xlab("Date") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~ station_abb, nrow = 5, ncol = 2)
dev.off()
```

##### Tidbits
```{r}
## Tidbit ##
png(filename = "../Figures/Temp_Water_Tidbit.png", width = 6.5, height = 4.8, res = 400, units = "in")
ggplot(tid.daily) +
  geom_line(aes(x = date_short, y = mean_temp), size = 0.5) +
  geom_ribbon(aes(x = date_short, ymin = mean_temp - sd_temp, ymax = mean_temp + sd_temp), alpha = 0.4) +
  scale_y_continuous(limits = c(-5, 33), breaks = seq(-5, 30, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y") +
  ylab("Temperature (°C)") +
  xlab("Date") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 14)) +
  facet_wrap(~ station_abb, nrow = 3, ncol = 2)
dev.off()
```

#### Dissolved oxygen
```{r echo=FALSE}
png(filename = "../Figures/DO_Point.png", width = 6.5, height = 8, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id != "FBWS_11")) +
  geom_point(aes(x = sample_date, y = DO_mgL), size = 2) +
  scale_y_continuous(limits = c(0, 18), breaks = seq(0, 18, by = 4))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y") +
  ylab("DO (mg/l)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1 , size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, nrow = 5, ncol = 2)
dev.off()
```

#### Salinity
```{r}
png(filename = "../Figures/Sal_Point.png", width = 3.5, height = 4, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = sal_ppt, shape = station_abb), size = 1.5) +
  scale_shape_manual(values = c(17, 16), labels = c("Mouth", "Nearshore")) +
  labs(color = "Station") +
  theme(legend.position = "none") +
  scale_y_continuous(limits = c(0, 36), breaks = seq(0, 36, by = 4))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-03-30"), as.POSIXct("2022-09-01"))) +
  ylab("Salinity (ppt)") +
  xlab("Month - Year") +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust = 1))
dev.off()

p.sal <- ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = sal_ppt, shape = station_abb, color = station_abb), size = 1.6) +
  scale_shape_manual(values = c(17, 16), labels = c("Mouth", "Nearshore")) +
  scale_color_manual(values = c("#678F22", "#002575")) +
  labs(color = "Station") +
  theme(legend.position = "none") +
  scale_y_continuous(limits = c(0, 36), breaks = seq(0, 36, by = 4))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-03-30"), as.POSIXct("2022-09-01"))) +
  ylab("Salinity (ppt)") +
  xlab("") +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(plot.margin = unit(c(0, 0, 0 , 0.55), "cm"))
```

#### Total Phosphorus
```{r}
## TP ##
png(filename = "../Figures/TP_Point.png", width = 6.5, height = 8, res = 400, units = "in")
ggplot(dat %>%
         filter(!station_id %in% c("FBWS_11"))) +
  geom_point(aes(x = sample_date, y = TP_umol), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Total P (\u00b5mol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 5, ncol = 2)
dev.off()

png(filename = "../Figures/TP_Point_redu.png", width = 6.5, height = 8, res = 400, units = "in")
ggplot(dat %>%
         filter(!station_id %in% c("FBWS_11"))) +
  geom_point(aes(x = sample_date, y = TP_umol), size = 1.75) +
  scale_y_continuous(limits = c(0, 20), breaks = seq(0, 20, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Total P (\u00b5mol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, nrow = 5, ncol = 2)
dev.off()

## TP Station 1 and 2 only ##
png(filename = "../Figures/TP_Point_1_2.png", width = 5, height = 4, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = TP_umol), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Total P (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()

## TP Station 1, 2 and 3 ##
png(filename = "../Figures/TP_Point_1_2_3.png", width = 5, height = 8, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2", "FBWS_3"))) +
  geom_point(aes(x = sample_date, y = TP_umol), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Total P (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 3, ncol = 1)
dev.off()

ann_text3 <- data.frame(sample_date = c(as.POSIXct("2022-08-16 00:00:00"), as.POSIXct("2021-08-23 00:00:00"), as.POSIXct("2021-08-23 00:00:00")),
                       TP_umol = c(NA, 20, NA),
                       station_abb = factor(c("3:FBC - Bailer Hill", "2:FBC - Mouth", "1:FB - Nearshore"), levels = c("3:FBC - Bailer Hill","2:FBC - Mouth", "1:FB - Nearshore")),
                       lab = c("", "42.7", ""))

p.tp <- ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2", "FBWS_3"))) +
  geom_point(aes(x = sample_date, y = TP_umol, shape = station_abb, color = station_abb), size = 1.6) +
  scale_shape_manual(values = c(15, 17, 16), labels = c("Bailer", "Mouth", "Nearshore")) +
  scale_color_manual(values = c("#E6003D", "#678F22", "#002575")) +
  scale_y_continuous(limits = c(0, 20), breaks = seq(0, 20, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-03-30"), as.POSIXct("2022-09-01"))) +
  ylab("Total P (\u00b5mol)") +
  xlab("") +
  theme(legend.position = "none") +
  geom_text(aes(x = sample_date, y = TP_umol), label = c("", "42.7", ""), data = ann_text3, size = 3) +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust = 1))

## TP minus ##
png(filename = "../Figures/TP_minus_P_Point.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = TP_minus_umol), size = 1.75) +
  scale_y_continuous(limits = c(0, 20), breaks = seq(0, 20, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Total P - PO4 (\u00b5mol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()

## TP / Phosphate ##
png(filename = "../Figures/TP_P_Point.png", width = 5, height = 6, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = (TP_umol / PO4_umol)), size = 1.75) +
  scale_y_continuous(limits = c(0, 8), breaks = seq(0, 8, by = 2)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Total P (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()
```

#### Total Nitrogen
```{r}
## TN ##
png(filename = "../Figures/TN_Point.png", width = 6.5, height = 8, res = 400, units = "in")
ggplot(dat %>%
        filter(!station_id %in% c("FBWS_11"))) +
  geom_point(aes(x = sample_date, y = TN_umol), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Total N (\u00b5mol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 5, ncol = 2)
dev.off()

## TN  Station 1 and 2 ##
png(filename = "../Figures/TN_Point_1_2.png", width = 5, height = 6, res = 400, units = "in")
ggplot(dat %>%
        filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = TN_umol), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Total N (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()

## TN  Station 1, 2, 3 ##
png(filename = "../Figures/TN_Point_1_2_3.png", width = 5, height = 8, res = 400, units = "in")
ggplot(dat %>%
        filter(station_id %in% c("FBWS_1", "FBWS_2", "FBWS_3"))) +
  geom_point(aes(x = sample_date, y = TN_umol), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Total N (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 3, ncol = 1)
dev.off()

ann_text4 <- data.frame(sample_date = c(as.POSIXct("2021-08-16 00:00:00"), as.POSIXct("2021-08-16 00:00:00"), as.POSIXct("2021-08-16 00:00:00")),
                       TN_umol = c(NA, 300, NA),
                       station_abb = factor(c("3:FBC - Bailer Hill", "2:FBC - Mouth", "1:FB - Nearshore"), levels = c("3:FBC - Bailer Hill","2:FBC - Mouth", "1:FB - Nearshore")),
                       lab = c("", "606.7", ""))

p.tn <- ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2", "FBWS_3"))) +
  geom_point(aes(x = sample_date, y = TN_umol, shape = station_abb, color = station_abb), size = 1.6) +
  scale_shape_manual(values = c(15, 17, 16), labels = c("Bailer", "Mouth", "Nearshore")) +
  scale_color_manual(values = c("#E6003D", "#678F22", "#002575")) +
  scale_y_continuous(limits = c(0, 300), breaks = seq(0, 300, by = 50)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-03-30"), as.POSIXct("2022-09-01"))) +
  ylab("Total N (\u00b5mol)") +
  xlab("Month - Year") +
  theme(legend.position = "none") +
  geom_text(aes(x = sample_date, y = TN_umol), label = c("", "606.7", ""), data = ann_text4, size = 3) +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust = 1))

## N members ##
png(filename = "../Figures/N_Point.png", width = 5, height = 6, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = N_Total_umol), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("N members (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()

## TN minus ##
png(filename = "../Figures/TN_minus_N_Point.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = TN_minus_umol), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("TN - N species (\u00b5mol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()

## TN / N members ##
png(filename = "../Figures/TN_N_Point.png", width = 5, height = 6, res = 400, units = "in")
ggplot(dat %>%
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = (TN_umol / N_Total_umol)), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("TN / N members") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()
```

#### N:P
```{r}
## N:P all sites ##
png(filename = "../Figures/NtoP_Point.png", width = 6.5, height = 8, res = 400, units = "in")
ggplot(dat %>%
        filter(!station_id %in% c("FBWS_11"))) +
  geom_point(aes(x = sample_date, y = N_P), size = 1.75) +
  geom_hline(aes(yintercept = 16), color = "red") +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("N:P") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 5, ncol = 2)
dev.off()

## N:P stations 1 and 2 ##
png(filename = "../Figures/NtoP_Point_1_2.png", width = 5, height = 6, res = 400, units = "in")
ggplot(dat %>%
        filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = N_P), size = 1.75) +
  geom_hline(aes(yintercept = 16), color = "red") +
  scale_y_continuous(limits = c(0, 40), breaks = seq(0, 40, by = 10)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("N:P") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()

## N:P minus stations 1 and 2 ##
png(filename = "../Figures/NminustoPminus_Point_1_2.png", width = 5, height = 6, res = 400, units = "in")
ggplot(dat %>%
        filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = Nminus_Pminus), size = 1.75) +
  geom_hline(aes(yintercept = 16), color = "red") +
  scale_y_continuous(limits = c(0, 48), breaks = seq(0, 40, by = 10)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("N minus:P minus") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, nrow = 2, ncol = 1)
dev.off()
```

#### Phosphate
```{r}
ann_text <- data.frame(sample_date = c(as.POSIXct("2021-08-23 00:00:00"), as.POSIXct("2021-08-23 00:00:00")),
                       PO4_umol = c(4, NA),
                       station_abb = factor(c("2:FBC - Mouth", "1:FB - Nearshore"), levels = c("2:FBC - Mouth", "1:FB - Nearshore")),
                       lab = c("23.2", ""))

png(filename = "../Figures/Phos_Point.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = PO4_umol), size = 1.75) +
  scale_y_continuous(limits = c(0, 4), breaks = seq(0, 4, by = 1)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Orthophosphate (\u00b5mol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, nrow = 2, ncol = 1) +
  geom_text(aes(x = sample_date, y = PO4_umol), label = c("23.2", ""), data = ann_text, size = 3)
dev.off()

p.po4 <- ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = PO4_umol, shape = station_abb, color = station_abb), size = 1.6) +
  scale_shape_manual(values = c(17, 16), labels = c("Mouth", "Nearshore")) +
  labs(color = "Station") +
  scale_color_manual(values = c("#678F22", "#002575")) +
  theme(legend.position = "none") +
  scale_y_continuous(limits = c(0, 4), breaks = seq(0, 4, by = 1)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Orthophosphate (\u00b5mol)") +
  xlab("") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(text = element_text(size = 10)) +
  geom_text(aes(x = sample_date, y = PO4_umol), label = c("23.2", ""), data = ann_text, size = 3) +
  theme(plot.margin = unit(c(0, 0, 0 , 0.55), "cm"))

png(filename = "../Figures/Phos_FBWS_1.png", width = 5, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1"))) +
  geom_point(aes(x = sample_date, y = PO4_umol), size = 2) +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Phosphate (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12))
dev.off()

png(filename = "../Figures/TP_Phos_FBWS_1.png", width = 5, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1"))) +
  geom_point(aes(x = sample_date, y = (TP_umol - PO4_umol)), size = 2) +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("TP - Phosphate (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12))
dev.off()
```

#### Nitrate
```{r}
png(filename = "../Figures/Nitrate_Point.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = NO3_umol), size = 1.75) +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Nitrate (\u00b5mol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, nrow = 2, ncol = 1)
dev.off()

p.no3 <- ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = NO3_umol, shape = station_abb, color = station_abb), size = 1.6) +
  scale_shape_manual(values = c(17, 16), labels = c("Mouth", "Nearshore")) +
  scale_color_manual(values = c("#678F22", "#002575")) +
  labs(color = "Station") +
  theme(legend.position = "none") +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Nitrate (\u00b5mol)") +
  xlab("") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(text = element_text(size = 10)) +
  theme(plot.margin = unit(c(0, 0, 0 , 0.55), "cm"))

png(filename = "../Figures/Nitrate_FBWS_1.png", width = 5, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% "FBWS_1")) +
  geom_point(aes(x = sample_date, y = NO3_umol), size = 2) +
  scale_y_continuous(limits = c(0, 25), breaks = seq(0, 25, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Nitrate (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12))
dev.off()
```

#### Nitrite
```{r}
png(filename = "../Figures/Nitrite_Point.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = NO2_umol), size = 1.75) +
  scale_y_continuous(limits = c(0, 1.2), breaks = seq(0, 1.2, by = 0.2)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Nitrite (\u00b5mol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, nrow = 2, ncol = 1)
dev.off()

p.no2 <- ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = NO2_umol, shape = station_abb, color = station_abb), size = 1.6) +
  scale_shape_manual(values = c(17, 16), labels = c("Mouth", "Nearshore")) +
  scale_color_manual(values = c("#678F22", "#002575")) +
  labs(color = "Station") +
  theme(legend.position = "none") +
  scale_y_continuous(limits = c(0, 1.2), breaks = seq(0, 1.2, by = 0.2)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Nitrite (\u00b5mol)") +
  xlab("") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(text = element_text(size = 10)) +
  theme(plot.margin = unit(c(0, 0, 0 , 0.55), "cm"))

ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = (NO2_umol / NO3_umol)), size = 1.75) +
  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.25)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("NO2/NO3") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, nrow = 2, ncol = 1)
```

#### Silicate
```{r}
png(filename = "../Figures/Silic_Point.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = SiOH4_umol), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Silicate (µmol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()
```

#### Ammonium
```{r}
png(filename = "../Figures/Ammon_Point.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = NH4_umol), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Ammonium (µmol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()

ann_text2 <- data.frame(sample_date = c(as.POSIXct("2021-08-16 00:00:00"), as.POSIXct("2021-10-15 00:00:00")),
                       NH4_umol = c(25, 25),
                       station_abb = factor(c("2:FBC - Mouth", "2:FBC - Mouth")),
                       lab = c("324.6", "68.8"))

p.nh4 <- ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = NH4_umol, shape = station_abb, color = station_abb), size = 1.6) +
  scale_shape_manual(values = c(17, 16), labels = c("Mouth", "Nearshore")) +
  scale_color_manual(values = c("#678F22", "#002575")) +
  labs(color = "Station") +
  theme(legend.position = "none") +
  scale_y_continuous(limits = c(0, 25), breaks = seq(0, 25, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Ammonium (\u00b5mol)") +
  xlab("Month - Year") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(text = element_text(size = 10)) +
  geom_text(aes(x = sample_date, y = NH4_umol), label = c("324.6", "68.8"), data = ann_text2, size = 3) +
  theme(plot.margin = unit(c(0, 0, 0 , 0.55), "cm"))

png(filename = "../Figures/Ammon_Point_log.png", width = 3.25, height = 4, res = 400, units = "in")
ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = log(NH4_umol + 1)), size = 1.75) +
  scale_y_continuous(limits = function(x){c(0, max(0.1, x) + max(x * 0.2))}) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  ylab("Log Ammonium + 1 (µmol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  facet_wrap(~station_abb, scales = "free", nrow = 2, ncol = 1)
dev.off()
```

#### Precipitation
```{r}
## Sampling window ##
png(filename = "../Figures/Precip_Airport_Samp.png", width = 4.5, height = 4, res = 400, units = "in")
ggplot(fh.monthly) +
  geom_col(aes(x = date, y = total.precip), fill = "#C1C1CC") +
    geom_errorbar(data = fh.monthly.sum, aes(x = date, ymin = sd_min_monthly, ymax = sd_max_monthly), width = 0) +
  geom_point(data = fh.monthly.sum, aes(x = date, y = mean_tot_precip), size = 1.5) +
  scale_y_continuous(limits = c(0, 250), breaks = seq(0, 250, by = 50)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-03-30"), as.POSIXct("2022-09-01"))) +
  ylab("Total precipitation (mm)") +
  xlab("Month") +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()

p.precip <- ggplot(fh.monthly) +
  geom_col(aes(x = date, y = total.precip), fill = "#C1C1CC") +
    geom_errorbar(data = fh.monthly.sum, aes(x = date, ymin = sd_min_monthly, ymax = sd_max_monthly), width = 0) +
  geom_point(data = fh.monthly.sum, aes(x = date, y = mean_tot_precip), size = 1.5) +
  scale_y_continuous(limits = c(0, 250), breaks = seq(0, 250, by = 50)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-03-30"), as.POSIXct("2022-09-01"))) +
  ylab("Total precipitation (mm)") +
  xlab("") +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust=1)) +
  theme(plot.margin = unit(c(0, 0, 0 , 0.55), "cm"))

## All time ##
png(filename = "../Figures/Precip_Airport.png", width = 6.5, height = 4, res = 400, units = "in")
ggplot(fh.monthly) +
  geom_col(aes(x = date, y = total.precip)) +
  geom_smooth(aes(x = date, y = total.precip), method = "loess") +
  scale_y_continuous(limits = c(0, 250), breaks = seq(0, 250, by = 50), sec.axis = sec_axis(trans = ~./24.5, name = "Total precipitation (in)")) +
  scale_x_datetime(date_breaks = "year", date_labels = "%Y") +
  ylab("Total precipitation (mm)") +
  xlab("") +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()
```

#### Wind
Daily mean at the FH airport

```{r}
## Sampling time frame ##
png(filename = "../Figures/AvgWind_Airport.png", width = 5, height = 4, res = 400, units = "in")
ggplot(fh) +
  geom_point(aes(x = DATE, y = AWND), size = 1) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2020-04-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  scale_y_continuous(limits = c(0, 12), breaks = seq(0, 12, by = 2)) +
  ylab("Mean daily wind speed (m/s)") +
  xlab("Date") +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()

## Last 10 years ##
png(filename = "../Figures/AvgWind_Airport_10yr.png", width = 5, height = 4, res = 400, units = "in")
ggplot(fh) +
  geom_point(aes(x = DATE, y = AWND), size = 0.5) +
  scale_x_datetime(date_breaks = "year", date_labels = "%Y", limits = c(as.POSIXct("2012-01-01 00:00:00"), as.POSIXct("2022-12-01 00:00:00"))) +
  scale_y_continuous(limits = c(0, 12), breaks = seq(0, 12, by = 2)) +
  ylab("Mean daily wind speed (m/s)") +
  xlab("Date") +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()
```


#### Upwelling
```{r}
png(filename = "../Figures/LaPush_Upwelling.png", width = 5, height = 4, res = 400, units = "in")
ggplot(upwell) +
  geom_point(aes(x = Date, y = OffTrans_m3s), size = 1) +
  geom_hline(aes(yintercept = 0), color = "#8F8F8F") +
  scale_y_continuous(limits = c(-1000, 250), breaks = seq(-1000, 250, by = 100)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y") +
  ylab("Offshore Transport Index") +
  xlab("Date") +
  theme(text = element_text(size = 12), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()

png(filename = "../Figures/LaPush_Upwell_2010_2022.png", width = 11, height = 4, res = 400, units = "in")
ggplot(upwell.month) +
  geom_col(aes(x = date, y = mean_OffTrans_m3s), size = 1) +
  geom_hline(aes(yintercept = 0), color = "#8F8F8F") +
  scale_y_continuous(limits = c(-200, 50), breaks = seq(-200, 50, by = 50)) +
  scale_x_datetime(date_breaks = "year", date_labels = "%Y", minor_breaks = "month") +
  ylab("Mean Offshore Transport Index") +
  xlab("Date") +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust=1)) +
  theme(panel.grid.major = element_line(color = "#D6D6D6", size = 0.5))
dev.off()
```


#### Combo plots

Ulva, Precip, Salinity

```{r}
png(filename = "../Figures/Ulva_Precip_Sal_Temp.png", width = 4, height = 8.5, res = 400, units = "in")
plot_grid(p.ulva, p.precip, p.sal, p.temp, nrow = 4, ncol = 1, labels = "auto", align = "v")
dev.off()
```

nutrients
```{r}
png(filename = "../Figures/PO2_NO3_NO2_NH4.png", width = 4, height = 8.5, res = 400, units = "in")
plot_grid(p.po4, p.no3, p.no2, p.nh4, nrow = 4, ncol = 1, labels = "auto", align = "v")
dev.off()

png(filename = "../Figures/TN_TP_1_2_3.png", width = 4, height = 5, res = 400, units = "in")
plot_grid(p.tp, p.tn, nrow = 2, ncol = 1, labels = "auto", align = "v")
dev.off()
```


```{r}
## Nitrate and ulva mass ##
p.no3 <- ggplot(dat %>% 
         filter(station_id %in% c("FBWS_1", "FBWS_2"))) +
  geom_point(aes(x = sample_date, y = NO3_umol, color = station_abb), size = 2) +
  geom_line(aes(x = sample_date, y = NO3_umol, color = station_abb), size = 1) +
  scale_color_manual("Station", values = c("#B0891C", "#3C4BBA")) +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, by = 5)) +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01"), as.POSIXct("2022-09-01"))) +
  ylab("NItrate (umol)") +
  xlab("Sample month") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  theme(text = element_text(size = 12)) +
  theme(legend.position = c(0.2, 0.9), legend.text = element_text(size = 6), legend.title = element_text(size = 10))

p.ulmass <- ggplot(ul) +
  geom_boxplot(aes(date, y = dry_mass_gmsq, group = date)) +
  scale_y_continuous(limits = c(0, 300), breaks = seq(0, 300, by = 50))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01"), as.POSIXct("2022-09-01"))) +
  ylab("Ulva mass (g/m sq)") +
  xlab("Month") +
  theme(text = element_text(size = 12), axis.text.x = element_text(angle = 45, hjust = 1 , size = 8))

png(filename = "../Figures/NO3_UlvaMass.png", width = 4, height = 6.5, res = 400, units = "in")
plot_grid(p.no3, p.ulmass, nrow = 2, ncol = 1, align = "v")
dev.off()
```


#### Air Temp
```{r}
png(filename = "../Figures/AirTemp_Airport_Samp.png", width = 5, height = 4, res = 400, units = "in")
ggplot(fh.monthly) +
  geom_point(aes(x = date, y = mean.tmax), size = 2, color = "red") +
  geom_point(aes(x = date, y = mean.tmin), size = 2, color = "blue") +
  scale_y_continuous(limits = c(-5, 30), breaks = seq(-5, 30, by = 5))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01"), as.POSIXct("2023-01-01"))) +
  ylab("Temperature (°C)") +
  xlab("Month") +
  theme(text = element_text(size = 12), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()
```

#### Ulva

On the ground
```{r}
## Plots of Means ##
png(filename = "../Figures/Ulva_mass.png", width = 4.5, height = 4, res = 400, units = "in")
ggplot(ul.sum) +
  geom_point(aes(x = date, y = mean_ul_mass_gmsq), size = 1.75) +
  geom_errorbar(aes(x = date, ymin = mean_ul_mass_gmsq - sd_ul_mass_gmsq, ymax = mean_ul_mass_gmsq + sd_ul_mass_gmsq), width = 0) +
  scale_y_continuous(limits = c(-30, 180), breaks = seq(-30, 180, by = 30))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-15"), as.POSIXct("2022-09-01"))) +
  ylab("Ulva mass (g/msq)") +
  xlab("Month") +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()

p.ulva <- ggplot(ul.sum) +
  geom_point(aes(x = date, y = mean_ul_mass_gmsq), size = 1.6) +
  geom_errorbar(aes(x = date, ymin = mean_ul_mass_gmsq - sd_ul_mass_gmsq, ymax = mean_ul_mass_gmsq + sd_ul_mass_gmsq), width = 0) +
  scale_y_continuous(limits = c(-30, 180), breaks = seq(-30, 180, by = 30))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-03-30"), as.POSIXct("2022-09-01"))) +
  ylab("Ulva mass (g/msq)") +
  xlab("") +
  theme(text = element_text(size = 10), axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(plot.margin = unit(c(0, 0, 0 , 0.55), "cm"))

## Box plot ##
png(filename = "../Figures/Ulva_mass_box.png", width = 4.5, height = 3, res = 400, units = "in")
ggplot(ul) +
  geom_boxplot(aes(date, y = dry_mass_gmsq, group = date)) +
  scale_y_continuous(limits = c(0, 300), breaks = seq(0, 300, by = 50))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01"), as.POSIXct("2022-09-01"))) +
  ylab("Ulva spp. mass (g/msq)") +
  xlab("Month") +
  theme(text = element_text(size = 12), axis.text.x = element_text(angle = 45, hjust=1))
dev.off()
```

#### Correlations
total N and P and nutrients between Bailer, creek mouth and nearshore
 
```{r}
test <- nuts %>% 
  filter(station_id %in% c("FBWS_1", "FBWS_2", "FBWS_3")) %>% 
  select(station_id, PO4_umol:TP_umol)

cor.nuts <- data.frame(Nutrient = c("Total P", "Total N", "Ortho-phosphate", "Silicate", "Nitrate", "Nitrite", "Ammonium"), 
                       one = c(cor(dat$TP_umol[dat$station_id == "FBWS_1"], dat$TP_umol[dat$station_id == "FBWS_2"]), cor(dat$TN_umol[dat$station_id == "FBWS_1"], dat$TN_umol[dat$station_id == "FBWS_2"]),cor(dat$PO4_umol[dat$station_id == "FBWS_1"], dat$PO4_umol[dat$station_id == "FBWS_2"]),cor(dat$SiOH4_umol[dat$station_id == "FBWS_1"], dat$SiOH4_umol[dat$station_id == "FBWS_2"]),cor(dat$NO3_umol[dat$station_id == "FBWS_1"], dat$NO3_umol[dat$station_id == "FBWS_2"]),cor(dat$NO2_umol[dat$station_id == "FBWS_1"], dat$NO2_umol[dat$station_id == "FBWS_2"]),cor(dat$NH4_umol[dat$station_id == "FBWS_1"], dat$NH4_umol[dat$station_id == "FBWS_2"])),
                       two = c(cor(dat$TP_umol[dat$station_id == "FBWS_1"], dat$TP_umol[dat$station_id == "FBWS_3"]), cor(dat$TN_umol[dat$station_id == "FBWS_1"], dat$TN_umol[dat$station_id == "FBWS_3"]), rep("ND", 5)),
                       three = c(cor(dat$TP_umol[dat$station_id == "FBWS_2"], dat$TP_umol[dat$station_id == "FBWS_3"]), cor(dat$TN_umol[dat$station_id == "FBWS_2"], dat$TN_umol[dat$station_id == "FBWS_3"]), rep("ND", 5))
                       )

colnames(cor.nuts) <- c("Nutrients", "Nearshore:Creek Mouth", "Nearshore:Bailer Hill", "Creek Mouth:Bailer Hill")

```
 

Drone
```{r}
mean(ul.drone$ul_percent_cover)

png(filename = "../Figures/Ulva_prop_drone.png", width = 4.5, height = 3, res = 400, units = "in")
ggplot(ul.drone) +
  geom_col(aes(x = sample_date, y = ul_percent_cover), size = 1.75) +
  scale_y_continuous(limits = c(0, 0.8), breaks = seq(0, 0.8, by = 0.2))  +
  scale_x_datetime(date_breaks = "month", date_labels = "%b %y", limits = c(as.POSIXct("2021-04-01"), as.POSIXct("2023-01-01"))) +
  ylab("Proportion Ulva spp.") +
  xlab("Month") +
  theme(text = element_text(size = 12), axis.text.x = element_text(angle = 45, hjust=1)) +
  annotate(geom = "text", x = as.POSIXct("2022-09-01"), y = 0.67, label = "*")
dev.off()
```

Flow
```{r}
ggplot(flow.sum) +
  geom_point(aes(x = date, y = flow_cfs, color = station_name), size = 2) +
  scale_color_manual("Station", labels = c("AUG-2", "FCB - Bailer Hill"), values = c("#AD640C", "#42AC0D")) +
  scale_y_continuous(limits = c(-2, 30), breaks = seq(0, 30, by = 5))  +
  #scale_x_datetime(breaks = seq(as.POSIXct("2021-10-15"), as.POSIXct("2021-12-1"), "day"), date_labels = "%b-%m", limits = c(as.POSIXct("2021-10-15"), as.POSIXct("2021-12-1"))) +
  ylab("Flow (CFS)") +
  xlab("Date")  +
  theme(text = element_text(size=20), axis.text.x = element_text(angle = 45, hjust = 1))
```
